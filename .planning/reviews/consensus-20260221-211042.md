# Consensus Review Report — Phase 8.6: Skill Generator Pipeline (LATM)

**Timestamp:** 2026-02-21T21:10:42Z
**Phase:** 8.6 — Skill Generator Pipeline with LATM Templates
**Reviewers:** 15 agents (error-handling, security, code-quality, documentation, test-coverage,
type-safety, complexity, build, task-spec, quality-patterns, codex, kimi, glm, minimax, code-simplifier)
**Review iteration:** 1

---

## Build Status: PASS

| Check | Result |
|-------|--------|
| cargo check | PASS |
| cargo clippy -D warnings | PASS |
| cargo fmt --check | PASS |
| Phase 8.6 tests (34/34) | PASS |
| Full suite runtime tests | SIGKILL (pre-existing — see below) |

---

## Pre-existing Test Failures (NOT introduced by Phase 8.6)

5 runtime unit tests in `src/host/handler.rs` are SIGKILL'd after ~640s:
- `runtime_start_transitions_to_running`
- `runtime_start_emits_starting_and_started_events`
- `runtime_stop_emits_stopped_event`
- `runtime_start_stop_start_full_lifecycle`
- `runtime_start_when_running_returns_error`

**Root cause:** These tests call `handler.request_runtime_start()` which spawns a
`PipelineCoordinator` that attempts to load `mistralrs` Qwen3-VL-8B model into GPU
memory (~72 GB). In a test environment this hangs indefinitely until SIGKILL.

**Origin:** Introduced in `feat(phase-1.2)` commit `ff1458d` — Phase 8.1 Task 2.
Phase 8.6 did NOT modify these tests or `request_runtime_start()`.

**Verdict:** Pre-existing known issue. Not a blocker for Phase 8.6 review.

---

## Consensus Findings (2+ votes)

### [MEDIUM] Debug format used for PythonSkillStatus in skill_generate_status — 9 votes

**File:** `src/host/handler.rs:1115`

**Finding:**
```rust
"status": format!("{:?}", info.status),
```

`PythonSkillStatus` has:
- `#[serde(rename_all = "snake_case")]` — serde uses `"active"`, `"pending"`, etc.
- A `Display` impl returning lowercase: `"active"`, `"pending"`, etc.
- `{:?}` (Debug) returns `"Active"`, `"Pending"` — PascalCase, inconsistent with the API contract.

All other status fields in the codebase use snake_case. The `skill.python.list` command
serializes `PythonSkillInfo` via serde which gives snake_case. This endpoint breaks that
consistency.

**Fix:**
```rust
"status": info.status.to_string(),
// or equivalently:
"status": serde_json::to_value(info.status).unwrap_or_default(),
```

**Severity:** MEDIUM — API inconsistency that will confuse callers.

**Votes:** error-handling, code-quality, documentation, type-safety, task-spec, quality-patterns,
codex, kimi, code-simplifier

---

### [LOW] unwrap_or_default() silently swallows serialization errors — 5 votes

**File:** `src/host/handler.rs:1081`

**Finding:**
```rust
let proposal_json = serde_json::to_value(&proposal).unwrap_or_default();
```

`SkillProposal` derives `Serialize` and contains only serializable types (String, Vec<String>,
Vec<CredentialSchemaView>, PathBuf with `#[serde(skip)]`). In practice this cannot fail.
However, `unwrap_or_default()` is forbidden by project standards and would silently return
`serde_json::Value::Null` if the path ever changed.

**Fix:**
```rust
let proposal_json = serde_json::to_value(&proposal)
    .map_err(|e| SpeechError::Config(format!("failed to serialize proposal: {e}")))?;
```

**Severity:** LOW — Cannot currently fail, but violates zero-tolerance for unwrap-family patterns.

**Votes:** error-handling, code-quality, type-safety, quality-patterns, codex

---

## Passing Areas (no issues)

- **skill_generator.rs:** Zero forbidden patterns in production code. All `unwrap/expect/panic!`
  are inside `#[cfg(test)]` with explicit `#![allow]`. ✓
- **channel.rs routing:** Input validation (trim + empty check) before dispatch. ✓
- **Documentation:** All public types and functions documented. ✓
- **Test coverage:** 26 unit tests + 8 integration tests = 34/34 PASS. ✓
- **Template correctness:** Generated skill template includes all required handlers
  (`handshake`, `invoke`, `health`, `shutdown`). ✓
- **Error propagation:** `install_proposal` uses `?` throughout. ✓
- **Security:** No credential leakage. `staging_dir` uses `#[serde(skip)]` to prevent
  leaking FS paths in responses. ✓
- **LATM pattern:** `intent_to_skill_id()` properly sanitizes intent to slug. ✓
- **Discovery integration:** `index_proposal()` correctly wires into sqlite-vec KNN index. ✓

---

## External Grades

- Codex: A- (two findings, both minor)
- Kimi K2: A- (agrees with Debug format issue)
- GLM-4.7: N/A (unavailable)
- MiniMax: N/A (unavailable)

**Overall Consensus: A- (SHOULD FIX 1 MEDIUM, 1 LOW — no blockers)**

---

## Required Actions

### SHOULD FIX (before task marked complete)

1. **Fix Debug format for PythonSkillStatus** (handler.rs:1115)
   - Change `format!("{:?}", info.status)` → `info.status.to_string()`
   - Ensures `skill.generate.status` API returns snake_case consistent with rest of API.

2. **Fix unwrap_or_default() on proposal serialization** (handler.rs:1081)
   - Change to proper `?` propagation with descriptive error message.
   - Aligns with zero-tolerance policy on unwrap-family patterns.

### NOT required

- Pre-existing runtime test SIGKILLs: tracked separately, not introduced by Phase 8.6.

---

## Verdict: SHOULD FIX (2 items) — Phase 8.6 is otherwise complete and spec-compliant.

Phase 8.6 delivered the full LATM pipeline: template generation, validation, installation,
discovery indexing, and host command routing. Test coverage is excellent (34/34). The two
findings are minor and do not affect correctness of the feature.
