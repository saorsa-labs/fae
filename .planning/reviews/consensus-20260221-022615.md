# Consensus Report — Phase 7.4: Hybrid Retrieval
# Generated: 2026-02-21

## Build Status
- cargo fmt: FAIL (formatting violations in sqlite.rs and types.rs)
- cargo clippy: PASS (zero warnings)
- cargo build: PASS

## Voter Tally: 15 Reviewers

| Reviewer | Verdict |
|----------|---------|
| build | WARN |
| error-handling | WARN |
| security | WARN |
| code-quality | WARN |
| documentation | PASS |
| test-coverage | WARN |
| type-safety | PASS |
| complexity | PASS |
| task-spec | WARN |
| quality-patterns | WARN |
| codex | WARN |
| kimi | WARN |
| glm | WARN |
| minimax | WARN |
| code-simplifier | PASS |

PASS: 4 | WARN: 11 | FAIL: 0

## Consensus: WARN — MUST FIX BEFORE COMMIT

## Findings by Vote Count

### MUST FIX (8+ votes — consensus)

**F1: cargo fmt violations** [12/15 votes]
- Reviewers: build(HIGH), error-handling, security, code-quality, documentation, test-coverage, type-safety, complexity, task-spec, quality-patterns, codex, minimax
- Files: src/memory/sqlite.rs (lines 573, 581-582, 1625), src/memory/types.rs (lines 410-413, 421-424)
- Fix: `cargo fmt --all`

**F2: semantic_weight config field not wired into hybrid_score()** [11/15 votes]
- Reviewers: code-quality(HIGH), task-spec(WARN), codex(HIGH), kimi(PRIMARY), glm(CRITICAL GAP), documentation(MEDIUM), test-coverage(HIGH), minimax, quality-patterns, codex, kimi
- Description: `MemoryConfig::semantic_weight` (default 0.60) is defined and documented as controlling hybrid scoring weight, but `hybrid_score()` uses hardcoded constant `HYBRID_SEMANTIC_WEIGHT = 0.60`. Config field is dead code.
- Fix: Pass `semantic_weight` into `hybrid_score()` as a parameter, or create a scorer struct that holds config.

### SHOULD FIX (4-7 votes)

**F3: Episode threshold magic numbers (0.4 / 0.6) should be named constants** [7/15 votes]
- Reviewers: code-quality, test-coverage, complexity, quality-patterns, codex, kimi, documentation
- Fix: Add `EPISODE_THRESHOLD_HYBRID: f32 = 0.4` and `EPISODE_THRESHOLD_LEXICAL: f32 = 0.6` constants

**F4: recall_context() hybrid path has no integration test** [6/15 votes]
- Reviewers: test-coverage(HIGH), task-spec, kimi, glm, minimax, codex
- Fix: Add test that verifies use_hybrid_search=true takes the hybrid path

**F5: HashMap import inside function body** [5/15 votes]
- Reviewers: quality-patterns(MEDIUM), code-quality, complexity, codex, glm
- Fix: Move `use std::collections::HashMap;` to module-level imports in sqlite.rs

### CONSIDER (2-3 votes)

**F6: Empty query guard in recall_context()** [3/15 votes]
- Reviewers: minimax, kimi, codex
- Fix: Add early return for empty/whitespace queries before embedding

**F7: Add debug logging for hybrid vs lexical path selection** [3/15 votes]
- Reviewers: minimax, glm, kimi
- Fix: `tracing::debug!(is_hybrid, "memory recall path selected")`

**F8: try_embed_query() lacks direct unit test** [2/15 votes]
- Reviewers: test-coverage(MEDIUM), glm

## External Grades
- Codex: B
- Kimi K2: B+
- GLM-4.7: B
- MiniMax: B+

## Action Plan

### Immediate (blocks merge)
1. `cargo fmt --all` — fixes F1
2. Wire `semantic_weight` config into `hybrid_score()` — fixes F2

### Should fix (pre-commit)
3. Add named constants for episode thresholds — fixes F3
4. Add integration test for recall_context hybrid path — fixes F4
5. Move HashMap import to module level — fixes F5

### Nice to have (post-merge)
6. Empty query guard
7. Debug logging for path selection
