# Consensus Review Report — v0.7.0 Qwen3-VL Vision Model Support

**Date:** 2026-02-20
**Scope:** Changed files for v0.7.0 release (vision model integration)
**Reviewers:** 15 agents (build, security, error-handling, code-quality, documentation, test-coverage, type-safety, complexity, task-spec, quality-patterns, codex, kimi, glm, minimax, code-simplifier)

---

## VERDICT: PASS

**Overall Grade: A-**
External grades: Codex A-, Kimi A, GLM B+, MiniMax A-

---

## Build Status

| Check | Result |
|-------|--------|
| cargo check | PASS |
| cargo clippy -D warnings | PASS |
| cargo fmt --check | PASS |
| cargo nextest run (2531 tests) | PASS (10 slow, all passing) |

---

## Finding Tally

### CRITICAL (blocking): 0 findings

### HIGH (blocking): 0 findings

### SHOULD FIX (2+ votes) — Non-blocking but recommended

| # | Finding | Votes | Files |
|---|---------|-------|-------|
| 1 | RAM-based model selection duplicated in startup.rs and coordinator.rs | 6/15 | `src/startup.rs:201-213`, `src/pipeline/coordinator.rs:1705-1712` |
| 2 | Fallback GGUF model strings hardcoded in `load_local_model`, not derived from constants | 3/15 | `src/llm/mod.rs:214-219` |
| 3 | `recommended_local_model` returns bare 4-tuple — positional binding is fragile | 3/15 | `src/config.rs:454-462` |

### MINOR (informational, 1 vote each)

| # | Finding | File |
|---|---------|------|
| 4 | `build_download_plan` uses `model_id.contains("8B")` heuristic for size estimation | `src/startup.rs:83` |
| 5 | Module-level doc in `llm/mod.rs` still says "GGUF models" but vision uses ISQ | `src/llm/mod.rs:1-5` |

---

## Positive Findings (unanimous)

- `HistoryEntry` discriminated union is the correct Rust pattern for mixed text/image history
- `vision_capable` is set from actual load result, not config flag — correct for fallback scenario
- Graceful fallback from vision to GGUF text-only on load failure
- `is_managed_default_model_id` guard prevents silent overwrite of user-customized configs
- `serde(default)` on `enable_vision: bool` preserves backward compatibility
- No `.unwrap()` or `.expect()` introduced anywhere
- All 2531 existing tests pass; 20+ new tests added covering all new behavior
- All public API items documented
- Module deletion (`model_picker.rs`, `model_selection.rs`) is clean — no dangling references

---

## Recommended Action for Finding #1 (highest priority SHOULD FIX)

Add to `src/config.rs`:

```rust
/// Apply RAM-based model selection to a config if the current model_id is a managed default.
/// This guards against silently overwriting user-customized model IDs.
pub fn apply_ram_model_selection(llm: &mut LlmConfig) {
    if is_managed_default_model_id(&llm.model_id) {
        let ram = crate::system_profile::detect_total_memory_bytes();
        let (mid, gf, tid, ev) = recommended_local_model(ram);
        llm.model_id = mid.to_owned();
        llm.gguf_file = gf.to_owned();
        llm.tokenizer_id = tid.to_owned();
        llm.enable_vision = ev;
    }
}
```

Then replace both call sites with:
```rust
crate::config::apply_ram_model_selection(&mut config.llm);
```

---

## Exit Conditions Check

- [x] Zero CRITICAL findings
- [x] Zero HIGH findings
- [x] Build passes
- [x] All external grades B or higher (Codex A-, Kimi A, GLM B+, MiniMax A-)

**VERDICT: PASS — ready to release as v0.7.0**

Finding #1 (duplicate RAM selection) is recommended to fix before or shortly after release. Findings #2-#5 are low-priority maintenance items.
