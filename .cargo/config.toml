[build]
# Cap parallel jobs to avoid OOM with heavy crates (mistralrs, ort, parakeet-rs).
# Each rustc can use 4-8GB; 6 jobs ≈ 48GB peak on a 96GB machine.
jobs = 6

# Mold linker for fast local linking (set via environment or ~/.cargo/config.toml).
# Removed from repo config because /opt/zerobrew/prefix/bin/mold doesn't exist on CI.
# To enable locally, add to ~/.cargo/config.toml:
#   [target.aarch64-apple-darwin]
#   rustflags = ["-C", "link-arg=-fuse-ld=/opt/zerobrew/prefix/bin/mold"]

[profile.dev]
opt-level = 0
debug = "line-tables-only"
split-debuginfo = "unpacked"
incremental = true

[profile.dev.package."*"]
opt-level = 2

[profile.test]
opt-level = 1
debug = false
codegen-units = 1

# Prevent SIMD codegen explosion in gemm/candle dependencies during tests.
# Without this, opt-level = 2 from [profile.dev.package."*"] carries into
# test builds, causing 200GB+ RAM usage from 29 binaries × heavy ML crates.
[profile.test.package."*"]
opt-level = 0
